---
- name: Prepare for vault role
  gather_facts: True
  hosts: consul
  vars:
    consul_bind_interface: lo
    vault_bind_address: 127.0.0.1
    vault_api_addr: http://127.0.0.1:8200
    vault_config_dir: "/etc/vault"
    vault_log_keys: true
    vault_set_keys_fact: true
    vault_write_keys_file: true
  tasks:
    - name: Ensure /etc/vault exists
      file:
        path: /etc/vault
        state: directory
      become: true

    - include_role:
        name: vault

    # Idempotence test
    - include_role:
        name: vault
